<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è€æ–‘é¸ éŸ³ä¹ç›’</title>
  <link rel="stylesheet" href="../css/index.css">
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      background-color: #f78eae;
    }
  </style>
</head>

<body>
  <div id="app-music">
    <div id="app-musicbox">
      <!-- é¡¶éƒ¨titleå’Œæœç´¢æ  -->
      <div class="box-top">
        <div class="top-title">è€æ–‘é¸ éŸ³ä¹ç›’</div>
        <div class="top-search">
          <!-- æœç´¢éŸ³ä¹ æŒ‰å›è½¦æœç´¢ -->
          <input type="text" v-model="keywords" @keydown.enter="searchSongs">
          <span class="search">ğŸ”</span>
        </div>
      </div>
      <!-- content -->
      <div class="box-content">
        <!-- å·¦è¾¹å†…å®¹ -->
        <div class="content-left">
          <!-- æ­Œæ›²åˆ—è¡¨ -->
          <div class="music-list">
            <div class="music-list-item" v-for="(item,index) in songs" :key="item.id">
              <div class="item-audio" @click.stop="getAudio(item.id)">â–¶</div>
              <div class="songname" :title="item.name">{{item.name}}</div>
              <div :class="['mvbtn',{hidden:item.mvid==0}]" @click.stop="getMV(item.mvid)">mv</div>
            </div>
          </div>
        </div>
        <!-- ä¸­é—´çš„cdåŠ¨ç”» -->
        <div class="content-middle">
          <img src="../imgs/player_bar.png" alt="" :class="['player-bar',{playing:isAudioPlaying}]" />
          <img :src="coverUrl" alt="" class="cover" />
          <img src="../imgs/disc.png" alt="" :class="['disc',{autorotate:isAudioPlaying}]" />
        </div>
        <!-- å³è¾¹çš„çƒ­é—¨è¯„è®º -->
        <div class="content-right">
          <h4 class="comment-title">çƒ­é—¨ç•™è¨€</h4>
          <div class="comments-list">
            <div class="comments-list-item" v-for="(item,index) in hotComments" :key="item.commentId">
              <div class="item-left">
                <img :src="item.user.avatarUrl" alt="" />
              </div>
              <div class="item-right">
                <div class="nickName">{{item.user.nickname}}</div>
                <div class="content">{{item.content}}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- åº•éƒ¨ -->
      <div class="box-bottom">
        <audio ref="audio" @pause="handlePause" @play="handlePlay" :src="songUrl" controls="controls" loop="loop"
          autoplay="autoplay"></audio>
        <div :class="['video-box',{hidden:!isMVPlaying}]">
          <div class="video-close" @click.stop="closeMV">Ã—</div>
          <!-- pause() -->
          <video ref="video" :src="mvUrl" controls="controls" autoplay="autoplay" loop="loop"></video>
          <div class="video-mask"></div>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="../node_modules/vue/dist/vue.js"></script>
<script src="../node_modules/axios/dist/axios.min.js"></script>
<script src="../js/myaxios.js"></script>
<script>
  let vm = new Vue({
    // created ç”Ÿå‘½å‘¨æœŸ  è¯·æ±‚åˆå§‹æ•°æ®
    async created() {
      let res = await myaxios.get("search", {
        params: {
          keywords: "çƒ­é—¨",
        },
      });
      this.songs = res.result.songs;
    },
    el: '#app-music',
    data: {
      // å…³é”®è¯
      keywords: "çƒ­é—¨",
      // æ­Œæ›²åˆ—è¡¨ä¿¡æ¯
      songs: [],
      // æ­£åœ¨æ’­æ”¾æ­Œæ›²çš„url
      songUrl: "",
      // é»˜è®¤æƒ…å†µéŸ³é¢‘æ²¡æœ‰åœ¨æ’­æ”¾çš„
      isAudioPlaying: false,
      // é»˜è®¤æƒ…å†µMVä¸æ’­æ”¾
      isMVPlaying: false,
      // ä¸­é—´æ­Œæ›²å›¾ç‰‡
      coverUrl: "../imgs/cover.jpg",
      // çƒ­é—¨è¯„è®º
      hotComments: [],
      // MVæ’­æ”¾åœ°å€
      mvUrl: "",
    },
    methods: {
      // è·å–æ­Œæ›²ä¿¡æ¯
      getAudio: async function (id) {
        let res1 = await myaxios.get("song/url", {
          params: {
            id: id,
          },
        });
        this.songUrl = res1.data[0].url;
        this.isAudioPlaying = true;

        // è·å–æ­Œæ›²å¯¹åº”å›¾ç‰‡
        let res2 = await myaxios.get("song/detail", {
          params: {
            ids: id
          },
        });
        this.coverUrl = res2.songs[0].al.picUrl;

        // è·å–æ­Œæ›²è¯„è®º
        let res3 = await myaxios.get("comment/hot?type=0", {
          params: {
            id: id,
          },
        });
        this.hotComments = res3.hotComments;
      },
      // æ ¹æ®å…³é”®è¯æœç´¢æ­Œæ›²
      searchSongs: async function () {
        if (!this.keywords) {
          // å¦‚æœæœç´¢å…³é”®å­—ä¸ºç©º  è¿”å›false
          return false;
        };
        let res = await myaxios.get("search", {
          params: {
            keywords: this.keywords,
          },
        });
        this.songs = res.result.songs;
      },
      // æš‚åœéŸ³ä¹æ“ä½œ  ç»ˆæ­¢ä¸­é—´å†…å®¹çš„åŠ¨ç”»
      handlePause: function () {
        this.isAudioPlaying = false;
      },
      // æ’­æ”¾éŸ³ä¹æ“ä½œ  ç»§ç»­ä¸­é—´å†…å®¹çš„åŠ¨ç”»
      handlePlay: function () {
        this.isAudioPlaying = true;
      },
      // è·å–MVä¿¡æ¯ æ’­æ”¾MV  åœæ­¢å¤–éƒ¨çš„éŸ³ä¹æ’­æ”¾
      getMV: async function (id) {
        // é‡å¤è¿›å…¥æ—¶  è‡ªåŠ¨ä»å½“å‰ä½ç½®æ’­æ”¾
        this.$refs.video.play();
        // mvçŠ¶æ€æ”¹æˆåœ¨æ’­æ”¾
        this.isMVPlaying = true;
        // å…³é—­å¤–éƒ¨éŸ³é¢‘çš„æ’­æ”¾
        this.$refs.audio.pause();
        // è·å–mvæ’­æ”¾åœ°å€
        let res = await myaxios.get("mv/url", {
          params: {
            id: id,
          },
        });
        this.mvUrl = res.data.url;
      },
      // å…³é—­MV
      closeMV: function () {
        this.$refs.video.pause();
        this.isMVPlaying = false;
      },
    },
  })
</script>

</html>